<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[4-8_電波法] 実力テスト 第1回 (20問)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Noto Sans JP -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
        }
        /* 正解・不正解のスタイル */
        .question-correct {
            border: 2px solid #22c55e; /* green-500 */
        }
        .question-incorrect {
            border: 2px solid #ef4444; /* red-500 */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto px-4 py-12 max-w-3xl">
        
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">実力テスト 第1回 (20問)</h1>
            <p class="text-lg text-gray-700 mt-2">すべての問題に解答後、「採点する」ボタンを押してください。</p>
        </header>

        <!-- スコア表示エリア -->
        <div id="score-container" class="hidden bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-6 rounded-lg shadow-md mb-8" role="alert">
            <p class="text-2xl font-bold" id="score-text"></p>
        </div>

        <main id="test-container" class="space-y-6">
            <!-- 問題はここにJavaScriptで挿入されます -->
        </main>

        <footer class="mt-12 text-center space-y-6">
            <button id="submit-btn" 
                    class="w-full max-w-xs mx-auto bg-blue-600 text-white text-xl font-bold py-4 px-10 rounded-lg shadow-md hover:bg-blue-700 transition-colors duration-300 ease-in-out transform hover:-translate-y-1">
                採点する
            </button>
            <a href="index.html" 
               class="inline-block bg-gray-600 text-white text-lg font-bold py-3 px-8 rounded-lg shadow-md hover:bg-gray-700 transition-colors duration-300 ease-in-out">
                トップページに戻る
            </a>
        </footer>

    </div>

    <script>
        // 実力テスト 第1回 データ
        const testQuestions = [
            { questionId: "AT1-001", topic: "免許", questionType: "multipleChoice", questionText: "無線局免許と無線従事者免許の違いに関する記述として、最も適切なものはどれか。", options: [{ text: "前者は「人」、後者は「設備」の免許である。", isCorrect: false }, { text: "前者は「設備」、後者は「人」の免許である。", isCorrect: true }, { text: "どちらも「人」の免許だが、資格のレベルが違う。", isCorrect: false }, { text: "どちらも「設備」の免許だが、周波数が違う。", isCorrect: false }] },
            { questionId: "AT1-002", topic: "免許", questionType: "fillInTheBlank", questionText: "無線従事者免許は、例えるなら「自動車の【 1 】」である。", correctAnswers: ["運転免許証", "運転免許"] },
            { questionId: "AT1-003", topic: "免許", questionType: "multipleChoice", questionText: "無線局の免許状に記載されないものは、次のうちどれか。", options: [{ text: "識別信号（コールサイン）", isCorrect: false }, { text: "電波の型式、周波数および空中線電力", isCorrect: false }, { text: "主任無線従事者の資格", isCorrect: true }, { text: "免許の有効期間", isCorrect: false }] },
            { questionId: "AT1-004", topic: "型式検定", questionType: "multipleChoice", questionText: "「型式検定」制度が導入された主な理由として、正しいものはどれか。", options: [{ text: "無線設備のセキュリティを強化するため。", isCorrect: false }, { text: "無線従事者のスキルを認定するため。", isCorrect: false }, { text: "大量生産される無線設備の検査を効率化するため。", isCorrect: true }, { text: "特殊な無線設備の開発を促進するため。", isCorrect: false }] },
            { questionId: "AT1-005", topic: "型式検定", questionType: "fillInTheBlank", questionText: "型式検定では、メーカーが提出した【 1 】（代表の1台）が検査される。", correctAnswers: ["サンプル"] },
            { questionId: "AT1-006", topic: "型式検定", questionType: "multipleChoice", questionText: "型式検定に合格した際に「告示」される事項として、正しいものはどれか。", options: [{ text: "機器の型式名", isCorrect: true }, { text: "申請の年月日", isCorrect: false }, { text: "開発コスト", isCorrect: false }, { text: "検査担当者の氏名", isCorrect: false }] },
            { questionId: "AT1-007", topic: "通信の原則", questionType: "multipleChoice", questionText: "無線通信の原則として、「電波はみんなの共有財産である」という考えに基づかないものはどれか。", options: [{ text: "必要のない通信は行わない。", isCorrect: false }, { text: "通信はできる限り簡潔にする。", isCorrect: false }, { text: "通信エラーは放置してもよい。", isCorrect: true }, { text: "通信は正確に行う。", isCorrect: false }] },
            { questionId: "AT1-008", topic: "通信の原則", questionType: "fillInTheBlank", questionText: "無線通信は、正確に行うものとし、通信上の【 1 】を知ったときは、直ちに訂正しなければならない。", correctAnswers: ["誤り", "間違い", "あやまり"] },
            { questionId: "AT1-009", topic: "通信の原則", questionType: "multipleChoice", questionText: "無線通信で出所を明らかにするために使用する「識別信号」の別名は何か。", options: [{ text: "免許番号", isCorrect: false }, { text: "検定番号", isCorrect: false }, { text: "コールサイン", isCorrect: true }, { text: "シリアルナンバー", isCorrect: false }] },
            { questionId: "AT1-010", topic: "通信の原則", questionType: "fillInTheBlank", questionText: "NHK東京ラジオ第1放送のコールサインは【 1 】である。", correctAnswers: ["JOAK"] },
            { questionId: "AT1-011", topic: "非常通信", questionType: "multipleChoice", questionText: "無線局の「目的外使用」に関する記述として、正しいものはどれか。", options: [{ text: "原則として禁止されている。", isCorrect: true }, { text: "常に許可されている。", isCorrect: false }, { text: "申請すればいつでも許可される。", isCorrect: false }, { text: "目的外使用という概念は電波法にない。", isCorrect: false }] },
            { questionId: "AT1-012", topic: "非常通信", questionType: "multipleChoice", questionText: "電波法第52条のただし書きで、目的外使用が例外的に認められる通信はどれか。", options: [{ text: "遭難通信", isCorrect: true }, { text: "趣味の通信", isCorrect: false }, { text: "営利目的の広告通信", isCorrect: false }, { text: "定期的な点検通信", isCorrect: false }] },
            { questionId: "AT1-WANING", topic: "非常通信", questionType: "multipleChoice", questionText: "「非常通信」が許可される条件として、正しいものはどれか。", options: [{ text: "有線通信が混雑しているとき。", isCorrect: false }, { text: "有線通信が利用できないか、著しく困難であるとき。", isCorrect: true }, { text: "無線通信のテストを行いたいとき。", isCorrect: false }, { text: "節電のために有線通信を停止しているとき。", isCorrect: false }] },
            { questionId: "AT1-014", topic: "非常通信", questionType: "fillInTheBlank", questionText: "非常通信が許可される非常事態には、地震、台風、洪水、津波、雪害、火災、【 1 】などがある。", correctAnswers: ["暴動"] },
            { questionId: "AT1-015", topic: "非常通信", questionType: "multipleChoice", questionText: "非常通信の4つの目的として、誤っているものはどれか。", options: [{ text: "人命の救助", isCorrect: false }, { text: "災害の救援", isCorrect: false }, { text: "交通通信の確保", isCorrect: false }, { text: "放送の受信", isCorrect: true }] },
            { questionId: "AT1-016", topic: "免許", questionType: "fillInTheBlank", questionText: "無線局免許は、例えるなら「自動車の【 1 】」である。", correctAnswers: ["車検証"] },
            { questionId: "AT1-017", topic: "免許", questionType: "multipleChoice", questionText: "無線局免許状に記載される「無線局の種別」の例として、資料で挙げられているものはどれか。", options: [{ text: "タクシー無線、アマチュア無線", isCorrect: true }, { text: "普通免許、大型免許", isCorrect: false }, { text: "iPhone 17、Xperia Z", isCorrect: false }, { text: "JOAK、NHK東京", isCorrect: false }] },
            { questionId: "AT1-018", topic: "型式検定", questionType: "fillInTheBlank", questionText: "型式検定に合格した機器の型式（設計図）は、国（総務大臣）によって【 1 】される。", correctAnswers: ["告示"] },
            { questionId: "AT1-019", topic: "通信の原則", questionType: "multipleChoice", questionText: "無線通信の原則「できる限り簡潔でなければならない」理由として、最も適切なものはどれか。", options: [{ text: "通信料金を節約するため。", isCorrect: false }, { text: "電波（周波数）を独り占めせず、他の人が使えるようにするため。", isCorrect: true }, { text: "送信者の声帯を守るため。", isCorrect: false }, { text: "通信内容を暗号化しやすくするため。", isCorrect: false }] },
            { questionId: "AT1-020", topic: "非常通信", questionType: "fillInTheBlank", questionText: "非常通信の目的の一つである「【 1 】」は、救急車や支援物資のトラックが動けるようにするために重要である。", correctAnswers: ["交通通信の確保", "交通通信"] }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('test-container');
            const submitBtn = document.getElementById('submit-btn');
            const scoreContainer = document.getElementById('score-container');
            const scoreText = document.getElementById('score-text');

            if (!container || !submitBtn || !scoreContainer || !scoreText) return;

            // 1. 問題を描画する
            renderQuestions();

            // 2. 「採点する」ボタンのイベントリスナー
            submitBtn.addEventListener('click', scoreTest);

            function renderQuestions() {
                testQuestions.forEach((q, index) => {
                    const questionIndex = index + 1;
                    
                    const card = document.createElement('div');
                    card.id = `q-${q.questionId}`;
                    card.className = 'bg-white p-6 rounded-lg shadow-md border-2 border-transparent'; // 採点用に枠線を準備

                    let questionHtml = `<h2 class="text-xl font-bold mb-4">
                                            <span class="text-blue-600">問題 ${questionIndex}</span>
                                            <span class="ml-2 text-gray-800">${q.questionText}</span>
                                        </h2>`;

                    if (q.questionType === 'multipleChoice') {
                        questionHtml += '<div class="space-y-3">';
                        q.options.forEach((opt, i) => {
                            questionHtml += `
                                <label class="flex items-center p-3 rounded-md border border-gray-300 hover:bg-gray-50 transition-colors">
                                    <input type="radio" name="${q.questionId}" value="${i}" class="mr-3 text-blue-600 focus:ring-blue-500">
                                    <span>${opt.text}</span>
                                </label>
                            `;
                        });
                        questionHtml += '</div>';
                    } else if (q.questionType === 'fillInTheBlank') {
                        // 穴埋め問題の入力欄を生成
                        let blankIndex = 0;
                        const questionTextWithInputs = q.questionText.replace(/【 \d+ 】/g, () => {
                            return `<input type="text" 
                                           data-answer-index="${blankIndex++}" 
                                           class="inline-block w-48 mx-1 px-2 py-1 border border-gray-400 rounded-md focus:ring-blue-500 focus:border-blue-500">`;
                        });
                        questionHtml = `<h2 class="text-xl font-bold mb-4">
                                            <span class="text-blue-600">問題 ${questionIndex}</span>
                                            <span class="ml-2 text-gray-800">${questionTextWithInputs}</span>
                                        </h2>`;
                    }

                    // 採点結果表示エリア (最初は非表示)
                    questionHtml += `<div id="result-${q.questionId}" class="hidden mt-4 pt-4 border-t border-gray-200"></div>`;
                    
                    card.innerHTML = questionHtml;
                    container.appendChild(card);
                });
            }

            function scoreTest() {
                let score = 0;
                const totalQuestions = testQuestions.length;

                testQuestions.forEach(q => {
                    const card = document.getElementById(`q-${q.questionId}`);
                    const resultDiv = document.getElementById(`result-${q.questionId}`);
                    if (!card || !resultDiv) return;

                    let isCorrect = false;
                    let correctAnswerText = "";

                    card.classList.remove('question-correct', 'question-incorrect');

                    if (q.questionType === 'multipleChoice') {
                        const correctIndex = q.options.findIndex(opt => opt.isCorrect);
                        correctAnswerText = q.options[correctIndex]?.text || "N/A";
                        
                        const selectedRadio = card.querySelector(`input[name="${q.questionId}"]:checked`);
                        
                        if (selectedRadio && parseInt(selectedRadio.value) === correctIndex) {
                            isCorrect = true;
                        }

                    } else if (q.questionType === 'fillInTheBlank') {
                        const inputs = card.querySelectorAll('input[type="text"]');
                        let allBlanksCorrect = true;
                        let answerTexts = [];

                        // ユーザーの要件とJSONデータの不整合を吸収するロジック
                        // 1. 穴の数と正解の数が一致する場合 (例: 穴2, 正解2)
                        if (inputs.length === q.correctAnswers.length) {
                            inputs.forEach((input, i) => {
                                const userInput = input.value.trim();
                                const correctKeyword = q.correctAnswers[i];
                                answerTexts.push(correctKeyword);
                                // 要件: キーワードの「いずれかを含む」
                                if (!userInput.includes(correctKeyword)) {
                                    allBlanksCorrect = false;
                                }
                            });
                        } 
                        // 2. 穴が1つで、正解が複数（別解）ある場合 (例: 穴1, 正解3)
                        else if (inputs.length === 1) {
                            const userInput = inputs[0].value.trim();
                            const keywords = q.correctAnswers;
                            answerTexts.push(keywords.join(' または '));
                            
                            const foundMatch = keywords.some(keyword => userInput.includes(keyword));
                            if (!foundMatch) {
                                allBlanksCorrect = false;
                            }
                        } 
                        // 3. 上記以外は不整合として不正解
                        else {
                            allBlanksCorrect = false;
                            answerTexts.push(q.correctAnswers.join(', '));
                        }

                        isCorrect = allBlanksCorrect;
                        correctAnswerText = answerTexts.join(', ');
                    }

                    // 採点結果の反映
                    if (isCorrect) {
                        score++;
                        card.classList.add('question-correct');
                        resultDiv.innerHTML = `<p class="text-lg font-bold text-green-700">正解</p>`;
                    } else {
                        card.classList.add('question-incorrect');
                        resultDiv.innerHTML = `<p class="text-lg font-bold text-red-500">不正解</p>
                                               <p class="text-base text-gray-700 mt-1">【正解】 ${correctAnswerText}</p>`;
                    }
                    resultDiv.classList.remove('hidden');
                });

                // 総合スコアの表示
                scoreText.textContent = `あなたのスコア: ${score} / ${totalQuestions} 点`;
                scoreContainer.classList.remove('hidden');
                
                // ページ上部にスクロール
                scoreContainer.scrollIntoView({ behavior: 'smooth' });
            }
        });
    </script>

</body>
</html>

